stages:
  - test

variables:
  GIT_SUBMODULE_STRATEGY: normal
  DEBIAN_FRONTEND: noninteractive

.run-sequential-tests-template: &run-sequential-tests-template
  script:
    - pipenv run python tests/runtests.py -n 1 -Cr tests/[0-9]*

.run-parallel-tests-template: &run-parallel-tests-template
  script:
    - pipenv run python tests/runtests.py -n 4 -Cr tests/[0-9]*
    - cat tests/1_SBG_Timeseries/A_Velocity/run/run.output

test-sequential:
  image: python:3.9.0
  stage: test
  before_script:
    - apt-get update
    - /usr/local/bin/python -m pip install --upgrade pip
    - pip install pipenv
    - PIPENV_VENV_IN_PROJECT=1
    - pipenv --python $(which python)
    - pipenv install --ignore-pipfile
  dependencies:
  <<: *run-sequential-tests-template


test-parallel:
  image: python:3.9.0
  stage: test
  before_script:
    - apt-get update
    - /usr/local/bin/python -m pip install --upgrade pip
    - pip install pipenv
    - PIPENV_VENV_IN_PROJECT=1
    - pipenv --python $(which python)
    - pipenv install --ignore-pipfile
  dependencies:
  <<: *run-parallel-tests-template
